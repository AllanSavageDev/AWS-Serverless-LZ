<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/png" href="../img/terraform-icon.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API-NOTIFY Demo</title>
    <link rel="stylesheet" href="../css/style.css" />
</head>

<script src="../js/log.js"></script>

<body>
    <h2 style="margin-bottom: 8px;">API-NOTIFY Demo</h2>
    <br>
    <br>
    <div class="tabs">
        <input type="radio" id="tab1" name="tab-control" checked>
        <label for="tab1">About</label>
        <input type="radio" id="tab2" name="tab-control">
        <label for="tab2">Run Test</label>
        <input type="radio" id="tab3" name="tab-control">
        <label for="tab3">Terraform File</label>
        <input type="radio" id="tab4" name="tab-control">
        <label for="tab4">Python File</label>

        <input type="radio" id="tab5" name="tab-control">
        <label for="tab5" onclick="history.back()">Home</label>


        <div id="content1" class="tab-content">
            <br>
            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <h3>Demonstrates a secure Lambda → SNS connection inside a private subnet.</h3>
            </div>
            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                Browser → API Gateway → Lambda (VPC) → SNS
            </div>
            <hr style="margin:8px 0;">

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <br>
                <b>A simple CRUD REST API with running test, Terraform and Python file</b>
                <br>

                <p>
                    - The 'Run Test' tab will execute the API on AWS and return live output.<br>
                    - The 'Terraform' tab shows the main.tf which declaring this API<br>
                    - The 'Python' tab shows the lambda_hanlder.py and demonstrates how this is built<br>
                </p>
            </div>

            <br>



            <section class="api-info">
                <h3>About This API</h3>
                <p><strong>Endpoint Base URL:</strong> https://api.aws-serverless.net/api-notify</p>
                <p><strong>Purpose:</strong> Demonstrates AWS SNS-based notifications via API Gateway + Lambda.
                    Supports publishing messages, listing subscriptions, subscribing (email/SMS), and unsubscribing.</p>

                <ul>
                    <li><strong>POST</strong> – <code>/api-notify</code><br />
                        Publishes a message to the SNS topic.<br />
                        <em>Request Body:</em>
                        <pre>{
  "message": "Test notification from browser"
}</pre>
                        <em>Returns:</em> <code>{"status":"published","message_id":"...","message":"..."}</code>
                    </li>

                    <li><strong>GET</strong> – <code>/api-notify</code><br />
                        Lists all topic subscriptions.<br />
                        <em>Returns:</em> <code>{"count":1,"subscriptions":[...]}</code>
                    </li>

                    <li><strong>PUT</strong> – <code>/api-notify</code><br />
                        Creates a new subscription (email, SMS, etc).<br />
                        <em>Request Body:</em>
                        <pre>
{
  "protocol": "email",
  "endpoint": "user@example.com"
}
</pre>
                        <em>Returns:</em> <code>{"status":"subscribed","subscription_arn":"PENDING_CONFIRMATION"}</code>
                    </li>

                    <li><strong>DELETE</strong> – <code>/api-notify</code><br />
                        Unsubscribes an existing subscription.<br />
                        <em>Request Body:</em>
                        <pre>
{
  "subscription_arn": "arn:aws:sns:us-east-1:acct:topic:subid"
}
</pre>
                        <em>Returns:</em> <code>{"status":"unsubscribed","subscription_arn":"..."}</code>
                    </li>
                </ul>
            </section>
        </div>

        <div id="content2" class="tab-content">
            <br>

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <h3>Test /api-notify Live</h3>
            </div>

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                Browser → API Gateway → Lambda (VPC) → SNS
            </div>

            <hr style="margin:8px 0;">

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <br>
                <b>What This Demonstrates</b>
                <br>
                <p>
                    - Secure Lambda-to-SNS connection inside a private subnet<br>
                    - Credentials managed via AWS Secrets Manager<br>
                    - Exposed only through API Gateway (no public DB access)<br>
                    - Deployed and maintained via Terraform
                </p>
            </div>

            <br>
            <button id="runTest">Run Full Test</button>
            <br><br>

            <div id="log">Test output shown here ...</div>
        </div>


        <div id="content3" class="tab-content">
            <br>
            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <h3>Terraform Module declares only things specific to this API.</h3>
            </div>

            <hr style="margin:8px 0;">

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <p>
                    The Module structure allows seperation of independent functionality.
                </p>
                <p>
                    In this case we're using a Module to encapsulate the functionality of all resources sepcific to
                    invoking a Lambda functon via an API Gateway.
                </p>
            </div>

            <br>

            <div class="code-block">
                <script src="https://gist.github.com/AllanSavageDev/d3b1bd6c7ca5b301049ec647b61b84f5.js"></script>
            </div>
            <style>
                .code-block {
                    margin-top: 1em;
                    overflow-x: auto;
                }
            </style>
        </div>


        <div id="content4" class="tab-content">
            <br>
            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <h3>Python based Lambda handler.</h3>
            </div>

            <hr style="margin:8px 0;">

            <div
                style="font-family: monospace; font-size: 14px; line-height: 1.4em; margin-bottom: 16px; padding:0px 10px 0px 10px">
                <p>
                    Every lambda is backed by a lambda_handler.py that is the entry point of the function.
                </p>
                <p>
                    In this example we're using a standard design pattern to execute CRUD operations on a DynamoDB
                    table.
                </p>
            </div>

            <br>

            <div class="code-block">
                <script src="https://gist.github.com/AllanSavageDev/f0c2eb360af9bf39a681656b353e5a80.js"></script>
            </div>
            <style>
                .code-block {
                    margin-top: 1em;
                    overflow-x: auto;
                }
            </style>
        </div>

    </div>
    </div>

    <br>

    <footer style="text-align:center; margin-top:40px; color:#333; font-family:monospace;">
        <img src="../img/AllanLinkedIn.jpeg" alt="Allan Savage"
            style="width:120px; height:120px; border-radius:50%; border:2px solid #333; margin-bottom:10px;">
        <br><br>
        <div><strong style="color:#333;size:20px;">Allan Savage</strong></div>
        <br>
        <a href="https://www.linkedin.com/in/allan-savage-aws-dev" target="_blank" style="color:#333;">
            https://www.linkedin.com/in/allan-savage-aws-dev
        </a>
    </footer>

    <br>

    <p style="font-size: 12px; color:#777; margin-top:20px; text-align:center;">Built, Maintained & Deployed by Allan
        Savage • Terraform • Secure Serverless Architecture</p>

    <br><br>
    <script src="./logic.js"></script>

</body>

</html>